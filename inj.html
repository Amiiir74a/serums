<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>هیدراسیون تزریقی</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f3f3f3;
      direction: rtl;
      line-height: 2;
    }

    .card {
      background-color: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .section-header {
      background-color: #d0e6ff;
      padding: 10px 15px;
      border-radius: 10px;
      font-weight: bold;
      font-size: 18px;
      color: #0b5394;
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin: 10px 0;
    }

    .summary {
      background-color: #d0e6ff;
      padding: 10px 15px;
      border-radius: 10px;
      font-weight: bold;
      color: #0b5394;
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>

  <!-- کارت اول: هیدراسیون اولیه -->
  <div class="card">
    <div class="section-header">هیدراسیون اولیه</div>
    <div id="hydrationContent">در حال بارگذاری...</div>
    <div class="summary" id="totalVolume">مجموع سرم دریافتی: ۰ سی‌سی</div>
  </div>

  <!-- کارت دوم: Maintenance -->
  <div class="card" style="background-color: #e3f7e0;">
    <div class="section-header" style="background-color: #a5d6a7; color: #1b5e20;">Maintenance</div>
    <div id="maintenanceContent">در حال بارگذاری...</div>
  </div>

  <script src="maintenance.js"></script>
  <script src="hydration.js"></script>
  <script>
    // بررسی مقادیر localStorage
    const weight = parseFloat(localStorage.getItem('weight')) || 0;
    const age = parseInt(localStorage.getItem('age')) || 0;
    const type = localStorage.getItem('type') || "نامشخص";

    if (!weight || !age) {
      alert("اطلاعات وزن و سن وارد نشده است.");
      window.location.href = "index.html";
    }

    const isAdult = age > 16 || weight > 60;
    const isDehydration = ["اسهال", "استفراغ", "اسهال و استفراغ"].includes(type);
    const first_type = isDehydration ? "نرمال سالین" : "رینگر لاکتات یا رینگر";
    const fourth_type = isDehydration ? "FFP" : "FFP + PC";
    const third_type = "PC";
    const fourth_volume = 10 * weight;

    let first_volume, third_volume = 2;

    if (isAdult) {
      first_volume = 2000;
    } else {
      first_volume = 20 * weight;
    }

    // تولید HTML برای هیدراسیون
    function generateHydrationHtml() {
      let html = `
        <label><input type="checkbox" class="step" data-vol="${first_volume}"> ابتدا ${first_volume} سی‌سی ${first_type} طی ۲۰ دقیقه تزریق شود</label>
      `;

      if (isAdult) {
        html += `
          <label><input type="checkbox" class="step" data-vol="${first_volume}"> نوبت دوم مجدداً ${first_volume} سی‌سی طی ۲۰ دقیقه تزریق شود</label>
          <label><input type="checkbox" class="step" data-vol="${third_volume * 300}"> نوبت سوم ${third_volume} واحد ${third_type} تزریق شود (تقریبی معادل ${third_volume * 300} سی‌سی)</label>
        `;
      } else {
        html += `
          <label><input type="checkbox" class="step" data-vol="${first_volume}"> نوبت دوم مجدداً ${first_volume} سی‌سی طی ۲ ساعت تزریق شود</label>
          <label><input type="checkbox" class="step" data-vol="${first_volume}"> نوبت سوم ${first_volume} سی‌سی تزریق شود</label>
          <label><input type="checkbox" class="step" data-vol="${fourth_volume}"> نوبت چهارم ${fourth_volume} سی‌سی ${fourth_type} تزریق شود</label>
        `;
      }

      return html;
    }

    // مقداردهی هیدراسیون
    document.getElementById("hydrationContent").innerHTML = generateHydrationHtml();

    // جمع حجم‌ها با توجه به تیک‌ها
    const checkboxes = document.querySelectorAll('.step');
    checkboxes.forEach(cb => {
      cb.addEventListener('change', () => {
        let total = 0;
        checkboxes.forEach(c => {
          if (c.checked) total += parseFloat(c.dataset.vol);
        });
        document.getElementById("totalVolume").textContent = "مجموع سرم دریافتی: " + total + " سی‌سی";
      });
    });
  </script>

</body>
</html>
